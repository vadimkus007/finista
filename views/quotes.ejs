<% layout('layout/page') %>
<% stylesheet('/vendor/datatables/dataTables.bootstrap4.min.css') -%>
<% script('/vendor/datatables/jquery.dataTables.min.js') %>
<% script('/vendor/datatables/dataTables.bootstrap4.min.js') %>
<% script('/js/quotesTable.js') %>
<% block('title', 'Котировки') %>
<% block('menu', 'quotes') %>

      <section class="container-fluid">
      
        <div class="main-content">

          

          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#stock">Акции</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#etf">ETF/ПИФы</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#index">Индексы</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#bond">Облигации</a>
            </li>
          </ul>

          <div class="tab-content">
            
            <div class="tab-pane fade show active" id="stock">
              
              <table class = "table table-striped table-bordered table-hover" id = "quotesTable1">
                <thead>
                  <tr>
                    <th>Тикер</th>
                    <th>Компания</th>
                    <th>Последняя</th>
                    <th>Изменение, %</th>
                    <th>Открытие</th>
                    <th>Мин.</th>
                    <th>Макс.</th>
                    <th>Ср.взвеш.</th>
                    <th>Объем</th>
                    <th>Время</th>
                  </tr>
                </thead>
                <tfoot>
                </tfoot>
                <tbody>
                  <% data.shares.forEach(row => { %> 
                    <tr>
                      <td><a href = "/quotes/<%= row.SECID %>" ><%= row.SECID %></a></td>
                      <td><%= row.SHORTNAME %></td>
                      <td><%= row.LAST %></td>
                      <td>
                        <span style="
                        <% if(row.LASTTOPREVPRICE<0){ %>
                          color:red;
                        <% } %>
                        <% if(row.LASTTOPREVPRICE>0){ %>
                          color:green;
                        <% } %>
                        "> 
                        <%= row.LASTTOPREVPRICE %> 
                        %</span>
                      </td>
                      <td><%= row.OPEN %></td>
                      <td><%= row.LOW %></td>
                      <td><%= row.HIGH %></td>
                      <td><%= row.WAPRICE %></td>
                      <td><%= row.VALTODAY %></td>
                      <td><%= row.TIME %></td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>

            </div>
            <div class="">
            </div>

            <div class="tab-pane fade" id="etf">
              <table class = "table table-striped table-bordered table-hover" id = "quotesTable2">
                <thead>
                  <tr>
                    <th>Тикер</th>
                    <th>Компания</th>
                    <th>Последняя</th>
                    <th>Изменение, %</th>
                    <th>Открытие</th>
                    <th>Мин.</th>
                    <th>Макс.</th>
                    <th>Ср.взвеш.</th>
                    <th>Объем</th>
                    <th>Время</th>
                  </tr>
                </thead>
                <tfoot>
                </tfoot>
                <tbody>
                  <% data.etf.forEach(row => { %> 
                    <tr>
                      <td><a href = "/quotes/<%= row.SECID %>" ><%= row.SECID %></a></td>
                      <td><%= row.SHORTNAME %></td>
                      <td><%= row.LAST %></td>
                      <td>
                        <span style="
                        <% if(row.LASTTOPREVPRICE<0){ %>
                          color:red;
                        <% } %>
                        <% if(row.LASTTOPREVPRICE>0){ %>
                          color:green;
                        <% } %>
                        "> 
                        <%= row.LASTTOPREVPRICE %> 
                        %</span>
                      </td>
                      <td><%= row.OPEN %></td>
                      <td><%= row.LOW %></td>
                      <td><%= row.HIGH %></td>
                      <td><%= row.WAPRICE %></td>
                      <td><%= row.VALTODAY %></td>
                      <td><%= row.TIME %></td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>

            <div class="tab-pane fade" id="index">
              <table class = "table table-striped table-bordered table-hover" id = "quotesTable3">
                <thead>
                  <tr>
                    <th>Тикер</th>
                    <th>Название</th>
                    <th>Текущее значение</th>
                    <th>Изменение за день</th>
                    <th>Изменение за месяц</th>
                    <th>Изменение за год</th>
                  </tr>
                </thead>
                <tfoot>
                </tfoot>
                <tbody>
                  <% data.index.forEach(row => { %> 
                    <tr>
                      <td><a href = "/quotes/<%= row.SECID %>" ><%= row.SECID %></a></td>
                      <td><%= row.NAME %></td>
                      <td><%= row.CURRENTVALUE %></td>
                      <td><%= row.LASTCHANGETOOPENPRC %> %</td>
                      <td><%= row.MONTHCHANGEPRC %> %</td>
                      <td><%= row.YEARCHANGEPRC %> %</td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>

            </div>

            <div class="tab-pane fade" id="bond">
              <table class = "table table-striped table-bordered table-hover" id = "quotesTable4">
                <thead>
                  <tr>
                    <th>Тикер</th>
                    <th>Название</th>
                    <th>Цена посл., %</th>
                    <th>Изменение посл., %</th>
                    <th>Ср. взв. цена, %</th>
                    <th>Доход. посл. сд.</th>
                    <th>Дюрация</th>
                    <th>Сумма купона</th>
                    <th>Дата оферты</th>
                    <th>Дата погашения</th>
                    <th>Доходность к оферте</th>
                    <th>Доходность для последнего купона</th>
                  </tr>
                </thead>
                <tfoot>
                </tfoot>
                <tbody>
                  <% data.bonds.forEach(row => { %> 
                    <tr>
                      <td><a href = "/quotes/<%= row.SECID %>" ><%= row.SECID %></a></td>
                      <td><%= row.SHORTNAME %></td>
                      <td><% if (row.LAST) { %><%= row.LAST %> %<% } else {%>-<%}%></td>
                      <td><% if (row.LASTCHANGEPRCNT) { %><%= row.LASTCHANGEPRCNT %> %<% } else {%>-<%}%></td>
                      <td><% if (row.WAPRICE) { %><%= row.WAPRICE %> %<% } else {%>-<%}%></td>
                      <td><%= row.YIELD %> %</td>
                      <td><%= row.DURATION %></td>
                      <td><%= row.COUPONVALUE %></td>
                      <td><% if (row.OFFERDATE) { %><%= row.OFFERDATE %><% } else {%>-<%}%></td>
                      <td><%= row.MATDATE %></td>
                      <td><%= (row.YIELDTOOFFER) ? row.YIELDTOOFFER : '-' %></td>
                      <td><%= (row.YIELDLASTCOUPON) ? row.YIELDLASTCOUPON : '-' %></td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>

          </div>

        </div>

      </section>

